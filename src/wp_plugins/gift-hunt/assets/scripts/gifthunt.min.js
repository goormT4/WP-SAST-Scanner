function isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function toggleDisplayTypeFields(){"time"==this.value?(document.querySelector("#pageview_to_display_section").classList.add("hidden"),document.querySelector("#time_to_display_section").classList.remove("hidden")):(document.querySelector("#time_to_display_section").classList.add("hidden"),document.querySelector("#pageview_to_display_section").classList.remove("hidden"))}function toggelGiftSections(){"oneMany"==this.value?(document.querySelector("#gifthunt-card--more-gifts").classList.add("hidden"),document.querySelector("#gifthunt-card--one-gift").classList.remove("hidden")):(document.querySelector("#gifthunt-card--one-gift").classList.add("hidden"),document.querySelector("#gifthunt-card--more-gifts").classList.remove("hidden"))}function addNewGiftField(){let giftIndex=1;document.querySelectorAll("#gifthunt-card__section--gift-list .gift-item").forEach(giftItem=>{const currentIndex=parseInt(giftItem.dataset.giftId);currentIndex>=giftIndex&&(giftIndex=currentIndex+1)});let giftFieldTemplate=document.querySelector("#gift-field-template").textContent.replace(/%GIFTID%/gi,giftIndex).replace(/%GIFTDBID%/gi,"0").replace(/%GIFTGIFT%/gi,""),newField=document.createRange().createContextualFragment(giftFieldTemplate);document.querySelector("#gifthunt-card__section--gift-list").appendChild(newField)}jQuery(document).ready((function(){jQuery("#visible_from").datepicker({dateFormat:"yy-mm-dd",minDate:0}),jQuery("#visible_to").datepicker({dateFormat:"yy-mm-dd",minDate:0})})),document.querySelectorAll("input[name='display_type']").forEach(displayTypeRadio=>{displayTypeRadio.addEventListener("change",toggleDisplayTypeFields)}),document.querySelector("#form_collect_first_name").addEventListener("change",e=>{e.target.checked?document.querySelector("#form_label_first_name_section").classList.remove("hidden"):document.querySelector("#form_label_first_name_section").classList.add("hidden")}),document.querySelector("#form_collect_last_name").addEventListener("change",e=>{e.target.checked?document.querySelector("#form_label_last_name_section").classList.remove("hidden"):document.querySelector("#form_label_last_name_section").classList.add("hidden")}),document.querySelector("#form_collect_additional_information").addEventListener("change",e=>{e.target.checked?document.querySelector("#form_label_additional_information_section").classList.remove("hidden"):document.querySelector("#form_label_additional_information_section").classList.add("hidden")}),document.querySelectorAll("input[name='gift_type']").forEach(giftType=>{giftType.addEventListener("change",toggelGiftSections)}),document.querySelector("#success_email_send").addEventListener("change",e=>{e.target.checked?document.querySelectorAll(".success-email-section").forEach(section=>{section.classList.remove("hidden")}):document.querySelectorAll(".success-email-section").forEach(section=>{section.classList.add("hidden")})}),document.querySelector("#active").addEventListener("change",e=>{e.target.checked?(document.querySelector("#visible-from-section").classList.remove("hidden"),document.querySelector("#visible-to-section").classList.remove("hidden")):(document.querySelector("#visible-from-section").classList.add("hidden"),document.querySelector("#visible-to-section").classList.add("hidden"))}),document.querySelector("#gifthunt-add-gift-button").addEventListener("click",addNewGiftField),document.addEventListener("click",e=>{e.target.classList.contains("gifthunt__gift-item-remove-button")&&document.querySelector(`#gift-item-${e.target.dataset.giftId}`).remove()});const gifthuntRequiredFields=document.querySelectorAll("form [required]");function valueCheck(element){if(element.value)document.querySelector(`#gifthunt-error-message-${element.id}`)&&(element.classList.remove("gifthunt-field-error"),document.querySelector(`#gifthunt-error-message-${element.id}`).remove());else{if(element.classList.contains("gifthunt-field-error"))return;element.classList.add("gifthunt-field-error");let errorMessage=document.createElement("div");errorMessage.classList.add("gifthunt-error-message"),errorMessage.id=`gifthunt-error-message-${element.id}`,errorMessage.innerText=element.dataset.gifthuntError,element.parentNode.insertBefore(errorMessage,element.nextSibling)}}function toggleEditorError(editorId,action){"display"==action?document.querySelector(`#${editorId}-error-message`).classList.remove("hidden"):document.querySelector(`#${editorId}-error-message`).classList.add("hidden")}function toggleIconError(action){"display"==action?document.querySelector("#icon_error-message").classList.remove("hidden"):document.querySelector("#icon_error-message").classList.add("hidden")}function toggleIconPlacementError(action){"display"==action?document.querySelector("#icon_placement_error-message").classList.remove("hidden"):document.querySelector("#icon_placement_error-message").classList.add("hidden")}function toggleIconAnimationError(action){"display"==action?document.querySelector("#icon_animation_error-message").classList.remove("hidden"):document.querySelector("#icon_animation_error-message").classList.add("hidden")}function toggleVisibleToVisitorsError(action){"display"==action?document.querySelector("#visible_to_visitors_error-message").classList.remove("hidden"):document.querySelector("#visible_to_visitors_error-message").classList.add("hidden")}function togglePopupDesignError(action){"display"==action?document.querySelector("#popup_design_error-message").classList.remove("hidden"):document.querySelector("#popup_design_error-message").classList.add("hidden")}function toggleGiftTypeError(action){"display"==action?document.querySelector("#gift_type-error-message").classList.remove("hidden"):document.querySelector("#gift_type-error-message").classList.add("hidden")}function checkReadyToSave(){let gifthuntSessionData={},errorCount=0,errorMessages=[],requiredBasicFields=["#name"];const sessionType=document.querySelector('input[name="session_type"]:checked').value;"default"==sessionType?requiredBasicFields.push("#popup_title","#form_label_email","#form_label_legal","#form_legal_url","#popup_button","#success_email_sender_name","#success_email_sender_email","#success_email_subject"):"custom_popup"==sessionType&&requiredBasicFields.push("#custom_popup_close_button_text"),gifthuntSessionData.session_type=sessionType,requiredBasicFields.forEach(requiredField=>{const currentField=document.querySelector(requiredField);currentField.value?valueCheck(currentField):(errorCount++,valueCheck(currentField),errorMessages.push(currentField.dataset.gifthuntError)),gifthuntSessionData[currentField.id]=currentField.value});let requiredEditorFields=["popup_body","popup_submit_body","success_email_body"];"custom_popup"==sessionType&&(requiredEditorFields=["custom_popup_content"]),requiredEditorFields.forEach(requiredField=>{let currentValue="";currentValue=isVisible(document.querySelector(`#${requiredField}`))?document.querySelector(`#${requiredField}`).value:tinyMCE.editors[requiredField].getContent(),gifthuntSessionData[requiredField]=currentValue,""==currentValue.replace(/<[^>]*>?/gm,"")?(errorCount++,toggleEditorError(requiredField,"display"),errorMessages.push(document.querySelector(`#${requiredField}-error-message`).textContent)):toggleEditorError(requiredField,"hide")});const icon=document.querySelector("input[name='icon']:checked"),customIcon=document.querySelector("#custom_icon");icon?(toggleIconError("hide"),gifthuntSessionData.icon=icon.value,99==gifthuntSessionData.icon&&(""==customIcon.value?(errorCount++,toggleIconError("display")):(toggleIconError("hide"),gifthuntSessionData.custom_icon=customIcon.value))):(errorCount++,toggleIconError("display"),errorMessages.push(document.querySelector("#icon_error-message").textContent));const iconPlacement=document.querySelector("input[name='icon_placement']:checked");iconPlacement?(toggleIconPlacementError("hide"),gifthuntSessionData.icon_placement=iconPlacement.value):(errorCount++,toggleIconPlacementError("display"),errorMessages.push(document.querySelector("#icon_placement_error-message").textContent));const iconAnimation=document.querySelector("input[name='icon_animation']:checked");iconAnimation?(toggleIconAnimationError("hide"),gifthuntSessionData.icon_animation=iconAnimation.value):(errorCount++,toggleIconAnimationError("display"),errorMessages.push(document.querySelector("#icon_animation_error-message").textContent));const visibleToVisitors=document.querySelector("input[name='visible_to_visitors']:checked");visibleToVisitors?(toggleVisibleToVisitorsError("hide"),gifthuntSessionData.visible_to_visitors=visibleToVisitors.value):(errorCount++,toggleVisibleToVisitorsError("display"),errorMessages.push(document.querySelector("#visible_to_visitors_error-message").textContent));const displayType=document.querySelector("input[name='display_type']:checked").value;if("time"==displayType){const timeToDisplay=document.querySelector("#time_to_display");timeToDisplay.value?(gifthuntSessionData.time_to_display=timeToDisplay.value,gifthuntSessionData.display_type="time"):(errorCount++,valueCheck(timeToDisplay),errorMessages.push(timeToDisplay.dataset.gifthuntError)),document.querySelector("#pageview_to_display").value="5"}else{const pageViewToDisplay=document.querySelector("#pageview_to_display");pageViewToDisplay.value?(gifthuntSessionData.pageview_to_display=pageViewToDisplay.value,gifthuntSessionData.display_type="pageview"):(errorCount++,valueCheck(pageViewToDisplay),errorMessages.push(pageViewToDisplay.dataset.gifthuntError)),document.querySelector("#time_to_display").value="90"}const giftType=document.querySelector("input[name='gift_type']:checked");if(giftType||"default"!=sessionType?(toggleGiftTypeError("hide"),gifthuntSessionData.gift_type=giftType.value):(errorCount++,toggleGiftTypeError("display"),errorMessages.push(document.querySelector("#gift_type-error-message").textContent)),gifthuntSessionData.gift_type&&"oneMany"==gifthuntSessionData.gift_type&&"default"==sessionType){const gift=document.querySelector("#gift");gift.value?(valueCheck(gift),gifthuntSessionData.gift=gift.value):(errorCount++,valueCheck(gift),errorMessages.push(gift.dataset.gifthuntError))}else if(gifthuntSessionData.gift_type&&"oneMany"!=gifthuntSessionData.gift_type&&"default"==sessionType){let giftItems=[],giftItemsCount=0;const giftsError=document.querySelector("#gifts-error-message");document.querySelectorAll(".gift-item").forEach(giftItem=>{const currentGiftItem=giftItem.querySelector("input");currentGiftItem.value&&(giftItems.push({value:currentGiftItem.value,dbid:currentGiftItem.dataset.giftDbId}),giftItemsCount++)}),giftItemsCount?(gifthuntSessionData.gifts=giftItems,giftsError.classList.add("hidden")):(errorCount++,errorMessages.push(giftsError.textContent),giftsError.classList.remove("hidden"))}const checkboxFields=["allow_multiple_collect","form_collect_first_name","form_collect_last_name","form_collect_additional_information","success_email_send"];checkboxFields.forEach(checkboxField=>{gifthuntSessionData[checkboxField]=document.querySelector(`#${checkboxField}`).checked?1:0});const checkboxFieldsNames=["form_collect_first_name","form_collect_last_name","form_collect_additional_information"];checkboxFieldsNames.forEach(checkboxFieldName=>{const currentFieldId=checkboxFieldName.replace("collect","label"),currentField=document.querySelector(`#${currentFieldId}`);gifthuntSessionData[checkboxFieldName]&&!currentField.value&&"default"==sessionType?(errorCount++,valueCheck(currentField),errorMessages.push(currentField.dataset.gifthuntError)):"default"==sessionType&&(gifthuntSessionData[currentFieldId]=currentField.value,valueCheck(currentField))});const popupDesign=document.querySelector("input[name='popup_design']:checked");popupDesign||"default"!=sessionType?(togglePopupDesignError("hide"),gifthuntSessionData.popup_design=popupDesign.value):(errorCount++,togglePopupDesignError("display"),errorMessages.push(document.querySelector("#popup_design_error-message").textContent));const active=document.querySelector("#active");if(gifthuntSessionData.active=active.checked?1:0,gifthuntSessionData.active){const visibleFrom=document.querySelector("#visible_from"),visibleTo=document.querySelector("#visible_to");valueCheck(visibleFrom),valueCheck(visibleTo),visibleFrom.value?gifthuntSessionData.visible_from=visibleFrom.value:(errorCount++,errorMessages.push("Session start date is required")),visibleTo.value?gifthuntSessionData.visible_to=visibleTo.value:(errorCount++,errorMessages.push("Session end date is required"))}if(errorCount){const finalErrorMessage=errorMessages.map(errorMessage=>`<li> ${errorMessage}</li>`).join("");return document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML=`<ul>${finalErrorMessage}</ul>`,errorSection.classList.remove("hidden")}),document.querySelectorAll(".gifthunt-form-result--success").forEach(successSection=>{successSection.querySelector(".gifthunt-form-result__content").innerHTML="",successSection.classList.add("hidden")}),void document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden")}document.querySelectorAll(".gifthunt-form-result").forEach(formResultSection=>{formResultSection.classList.add("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.add("hidden");const gifthuntSaveButtons=document.querySelectorAll(".gifthunt-save-session");gifthuntSaveButtons.forEach(saveButton=>{saveButton.querySelector("i").classList.remove("hidden"),saveButton.disabled=!0});let gifthuntAction="create";giftSessionId&&(gifthuntAction="update"),gifthuntSessionData.id=giftSessionId;const data={nonce:gifthuntNonce,action:"gifthuntfree_action",gifthuntAction:gifthuntAction,gifthuntSessionData:gifthuntSessionData};jQuery.post(ajaxurl,data,response=>{if("success"!=response.status)document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML=response.data,errorSection.classList.remove("hidden")}),document.querySelectorAll(".gifthunt-form-result--success").forEach(successSection=>{successSection.querySelector(".gifthunt-form-result__content").innerHTML="",successSection.classList.add("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden");else{if("create"==gifthuntAction)return void(window.location.href=`admin.php?page=gifthuntfree-sessions&p=session-edit&id=${response.data}&msg=created`);{document.querySelectorAll(".gifthunt-form-result--success").forEach(successSection=>{successSection.querySelector(".gifthunt-form-result__content").innerHTML=response.data,successSection.classList.remove("hidden")}),document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML="",errorSection.classList.add("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden");const newGiftsList=response.gifts.map(gift=>{let currentGift=gift.gift.replace(/"/g,"&quot;"),giftFieldTemplate;return document.querySelector("#gift-field-template").textContent.replace(/%GIFTID%/gi,gift.id).replace(/%GIFTDBID%/gi,gift.id).replace(/%GIFTGIFT%/gi,currentGift)});document.querySelector("#gifthunt-card__section--gift-list").innerHTML=newGiftsList.join("")}}gifthuntSaveButtons.forEach(saveButton=>{saveButton.querySelector("i").classList.add("hidden"),saveButton.disabled=!1})})}gifthuntRequiredFields.forEach(requiredField=>{valueCheck(requiredField),requiredField.addEventListener("blur",()=>valueCheck(requiredField))}),document.querySelectorAll(".gifthunt-save-session").forEach(saveButton=>{saveButton.addEventListener("click",e=>{e.preventDefault(),checkReadyToSave()})}),document.querySelectorAll(".gifthunt-input-field").forEach(gifthuntInputField=>{gifthuntInputField.addEventListener("blur",e=>{e.target.value&&e.target.classList.contains("gifthunt-field-error")&&(e.target.classList.remove("gifthunt-field-error"),e.target.parentNode.querySelector(".gifthunt-error-message").classList.add("hidden"))})}),document.addEventListener("DOMContentLoaded",()=>{const giftType=document.querySelector("input[name='gift_type']:checked");if(giftType&&"oneMany"==giftType.value){const gift=document.querySelector("#gift");gift.value,valueCheck(gift)}else{let giftItems=[],giftItemsCount=0;const giftsError=document.querySelector("#gifts-error-message");document.querySelectorAll(".gift-item").forEach(giftItem=>{const currentGiftItem=giftItem.querySelector("input");currentGiftItem.value&&giftItemsCount++}),giftItemsCount?giftsError.classList.add("hidden"):giftsError.classList.remove("hidden")}}),document.querySelectorAll(".gifthunt-form-result__close-button").forEach(closeButton=>{closeButton.addEventListener("click",()=>{document.querySelectorAll(".gifthunt-form-result__modal").forEach(gifthuntModal=>{gifthuntModal.classList.add("hidden")})})}),giftSessionId>0&&document.querySelector("#button--session-delete").addEventListener("click",()=>{document.querySelector(".gifthunt-form__delete-confirm-modal").classList.remove("hidden")}),document.querySelector("#button--cancel-delete").addEventListener("click",()=>{document.querySelector(".gifthunt-form__delete-confirm-modal").classList.add("hidden")}),document.querySelector(".gifthunt-form__delete-confirm-modal__close-button").addEventListener("click",()=>{document.querySelector(".gifthunt-form__delete-confirm-modal").classList.add("hidden")}),document.querySelector("#button--confirm-delete").addEventListener("click",event=>{event.target.querySelector("i").classList.remove("hidden"),event.target.disabled=!0;let gifthuntAction="delete";const data={nonce:gifthuntNonce,action:"gifthuntfree_action",gifthuntAction:"delete",id:giftSessionId};jQuery.post(ajaxurl,data,response=>{event.target.querySelector("i").classList.add("hidden"),event.target.disabled=!1,document.querySelector(".gifthunt-form__delete-confirm-modal").classList.add("hidden"),"success"!=response.status?(document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML=response.data,errorSection.classList.remove("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden")):window.location.href="admin.php?page=gifthuntfree-sessions&msg=deleted"})}),document.querySelector("#gifthunt-send-test-success-email").addEventListener("click",()=>{document.querySelector(".gifthunt-form__test-mail-modal").classList.remove("hidden")}),document.querySelector("#button--cancel-send-testmail").addEventListener("click",()=>{document.querySelector(".gifthunt-form__test-mail-modal").classList.add("hidden")}),document.querySelector(".gifthunt-form__test-mail-modal__close-button").addEventListener("click",()=>{document.querySelector(".gifthunt-form__test-mail-modal").classList.add("hidden")}),document.querySelector("#button--confirm-send-testmail").addEventListener("click",event=>{const toMail=document.querySelector("#to").value;if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(toMail))return document.querySelector("#to").focus(),void alert("Please, use a valid email address");event.target.disabled=!0,event.target.querySelector("i").classList.remove("hidden");let gifthuntAction="send_test_mail",successEmailBodyContent="";successEmailBodyContent=isVisible(document.getElementById("success_email_body"))?document.getElementById("success_email_body").value:tinyMCE.editors.success_email_body.getContent();const data={nonce:gifthuntNonce,action:"gifthuntfree_action",gifthuntAction:gifthuntAction,to:toMail,success_email_sender_name:document.querySelector("#success_email_sender_name").value,success_email_sender_email:document.querySelector("#success_email_sender_email").value,success_email_subject:document.querySelector("#success_email_subject").value,success_email_body:successEmailBodyContent};jQuery.post(ajaxurl,data,response=>{event.target.querySelector("i").classList.add("hidden"),event.target.disabled=!1,document.querySelector(".gifthunt-form__test-mail-modal").classList.add("hidden"),"success"!=response.status?(document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML=response.data,errorSection.classList.remove("hidden")}),document.querySelectorAll(".gifthunt-form-result--success").forEach(successSection=>{successSection.querySelector(".gifthunt-form-result__content").innerHTML="",successSection.classList.add("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden")):(document.querySelectorAll(".gifthunt-form-result--success").forEach(successSection=>{successSection.querySelector(".gifthunt-form-result__content").innerHTML=response.data,successSection.classList.remove("hidden")}),document.querySelectorAll(".gifthunt-form-result--error").forEach(errorSection=>{errorSection.querySelector(".gifthunt-form-result__content").innerHTML="",errorSection.classList.add("hidden")}),document.querySelector(".gifthunt-form-result__modal").classList.remove("hidden"))})});const accordionTitle=document.querySelectorAll(".gifthunt-accordion__title");function toggleAccordion(title){const accordionSection=title.parentNode,accordion=accordionSection.parentNode;if(accordionSection.classList.contains("gifthunt-accordion__section--active"))return;const activeAccordionSection=accordion.querySelector(".gifthunt-accordion__section--active");activeAccordionSection&&activeAccordionSection.classList.remove("gifthunt-accordion__section--active"),accordionSection.classList.add("gifthunt-accordion__section--active")}accordionTitle.length&&accordionTitle.forEach(title=>{title.addEventListener("click",()=>toggleAccordion(title))});const gifthuntCustomIconUploadButton=document.querySelector("#gifthunt__icon-upload-button");if(gifthuntCustomIconUploadButton){let gifthuntCustomIconUploader;gifthuntCustomIconUploadButton.addEventListener("click",e=>{e.preventDefault(),gifthuntCustomIconUploader?gifthuntCustomIconUploader.open():((gifthuntCustomIconUploader=wp.media.frames.gifthuntCustomIconUploader=wp.media({title:"Select custom icon",button:{text:"Use this custom icon"},multiple:!1})).on("select",(function(){attachment=gifthuntCustomIconUploader.state().get("selection").first().toJSON(),document.querySelector("#custom_icon").value=attachment.url,document.querySelector("#gifthunt__icon-upload-preview img").src=attachment.url,document.querySelector("#gifthunt__icon-upload-preview label").style.display="block",document.querySelector("#gifthunt__icon-upload-preview input[type='radio']").checked=!0})),gifthuntCustomIconUploader.open())})}let currentLocation=window.top.location.href;currentLocation.includes("msg=created")&&window.history.pushState("gifthuntcreated","",currentLocation.replace("msg=created",""));const iconAnimationPreviewItems=document.querySelectorAll("#gifthunt__icon-animation-list label");function toggleAnimationPreview(event,iconAnimationItem){const animationPreviewSpan=iconAnimationItem.querySelector(".gifthunt-icon-animation-preview"),animationClass=animationPreviewSpan.dataset.animation;"mouseover"==event?animationPreviewSpan.querySelector("span").classList.add(animationClass):animationPreviewSpan.querySelector("span").classList.remove(animationClass)}iconAnimationPreviewItems&&iconAnimationPreviewItems.forEach(iconAnimationPreview=>{iconAnimationPreview.addEventListener("mouseover",()=>{toggleAnimationPreview("mouseover",iconAnimationPreview)}),iconAnimationPreview.addEventListener("mouseleave",()=>{toggleAnimationPreview("mouseleave",iconAnimationPreview)})});const popupDesignPreviewItems=document.querySelectorAll(".gifthunt-popup-design-preview"),popupPreviewModal=document.querySelector(".gifthunt-form__popup-design-preview-modal");function togglePopupDesignPreview(previewItem,action){if("display"==action){const previewImage=previewItem.querySelector("img");popupPreviewModal.innerHTML=previewImage.outerHTML,popupPreviewModal.classList.remove("hidden")}else popupPreviewModal.removeChild(popupPreviewModal.firstChild),popupPreviewModal.classList.add("hidden")}popupDesignPreviewItems&&popupPreviewModal&&(popupDesignPreviewItems.forEach(popupDesignPreviewItem=>{popupDesignPreviewItem.addEventListener("click",()=>{togglePopupDesignPreview(popupDesignPreviewItem,"display")})}),popupPreviewModal.addEventListener("click",()=>{togglePopupDesignPreview(this,"hide")}));const gifthuntFormAccordionLabels=document.querySelectorAll(".gifthunt-form-group__label--accordion");function toggleFormSectionBody(){const section=this.closest(".gifthunt-card__section");section.classList.contains("gifthunt-card__section--closed")?(section.classList.remove("gifthunt-card__section--closed"),section.classList.add("gifthunt-card__section--opened")):(section.classList.remove("gifthunt-card__section--opened"),section.classList.add("gifthunt-card__section--closed"))}gifthuntFormAccordionLabels&&gifthuntFormAccordionLabels.forEach(gifthuntFormAccordionLabel=>{gifthuntFormAccordionLabel.addEventListener("click",toggleFormSectionBody)});const successEmailPreviewItems=document.querySelectorAll("#gifthunt__success-email-template-list label"),successEmailPreviewModal=document.querySelector(".gifthunt-form__success-email-template-preview-modal"),successEmailPreviewModalBody=document.querySelector(".gifthunt-form__success-email-template-preview-modal .gifthunt-form__success-email-template-preview-modal-body"),successEmailPreviewModalCloseButton=document.querySelector(".gifthunt-form__success-email-template-preview-modal__close-button"),successEmailPreviewModalCancelButton=document.querySelector("#button--cancel-success-email-template-preview"),successEmailPreviewModalSelectTemplateButton=document.querySelector("#button--confirm-success-email-template-preview");let successEmailTemplate="";function successEmailUseSelectedTemplate(){const selectedTemplateHTML=document.querySelector(`#gifthunt-success-email-template-${successEmailTemplate}`).outerHTML;isVisible(document.getElementById("success_email_body"))?document.getElementById("success_email_body").value=selectedTemplateHTML:tinyMCE.editors.success_email_body.setContent(selectedTemplateHTML),toggleSuccessEmailPreview(null,"hide"),document.querySelector("#wp-success_email_body-wrap").scrollIntoView()}function toggleSuccessEmailPreview(previewItem,action){if("display"==action){successEmailTemplate=previewItem.dataset.template;const previewImage=previewItem.querySelector("img");successEmailPreviewModalBody.innerHTML=previewImage.outerHTML,successEmailPreviewModal.classList.remove("hidden")}else successEmailTemplate="",successEmailPreviewModalBody.removeChild(successEmailPreviewModalBody.firstChild),successEmailPreviewModal.classList.add("hidden")}successEmailPreviewItems&&successEmailPreviewModal&&(successEmailPreviewItems.forEach(successEmailPreviewItem=>{successEmailPreviewItem.addEventListener("click",()=>{toggleSuccessEmailPreview(successEmailPreviewItem,"display")})}),successEmailPreviewModalCloseButton.addEventListener("click",()=>{toggleSuccessEmailPreview(null,"hide")}),successEmailPreviewModalCancelButton.addEventListener("click",()=>{toggleSuccessEmailPreview(null,"hide")}),successEmailPreviewModalSelectTemplateButton.addEventListener("click",successEmailUseSelectedTemplate));const shortcodePlacementInput=document.getElementById("gifthunt-placement-shortcode");shortcodePlacementInput.addEventListener("focus",e=>{e.target.select()});const shortcodePlacementInfo=document.getElementById("gifthunt-placement-shortcode-info"),toggleIconShortcodeSection=e=>{const iconAnimationSection=document.getElementById("icon_animation_section"),displayTypeSection=document.getElementById("display_type_section"),displayTypeTimeSection=document.getElementById("time_to_display_section"),displayTypePageviewSection=document.getElementById("pageview_to_display_section");"shortcode"==e.target.value?(shortcodePlacementInfo.classList.remove("hidden"),iconAnimationSection.classList.add("hidden"),displayTypeSection.classList.add("hidden"),displayTypeTimeSection.classList.add("hidden"),displayTypePageviewSection.classList.add("hidden")):(shortcodePlacementInfo.classList.add("hidden"),iconAnimationSection.classList.remove("hidden"),displayTypeSection.classList.remove("hidden"),"time"==document.querySelector('input[name="display_type"]:checked').value?displayTypeTimeSection.classList.remove("hidden"):displayTypePageviewSection.classList.remove("hidden"))},iconPlacementOptions=document.querySelectorAll("input[name=icon_placement]");iconPlacementOptions.forEach(placementOption=>{placementOption.addEventListener("change",toggleIconShortcodeSection)});const shortcodePreviewAlertModal=document.querySelector(".gifthunt-form__shortcode-preview-alert-modal"),shortcodePreviewAlertCloseButton=document.querySelector(".gifthunt-form__shortcode-preview-alert-modal__close-button"),shortcodePreviewAlertPrimaryButton=document.getElementById("shortcode-preview-alert-close"),sessionPreviewButton=document.getElementById("gifthunt-session-preview-button");function toggleShortcodePreviewAlert(){shortcodePreviewAlertModal.classList.contains("hidden")?shortcodePreviewAlertModal.classList.remove("hidden"):shortcodePreviewAlertModal.classList.add("hidden")}shortcodePreviewAlertCloseButton.addEventListener("click",toggleShortcodePreviewAlert),sessionPreviewButton&&sessionPreviewButton.addEventListener("click",e=>{e.preventDefault();const previewURL=e.target.href,iconPlacementSelectedOption=document.querySelector('input[name="icon_placement"]:checked'),sessionShortcodePreviewStatus=document.getElementById("shortcode-preview-current-status"),sessionShortcodePreviewDateSettings=document.getElementById("shortcode-preview-date-settings");document.querySelector('input[name="active"]').checked?sessionShortcodePreviewStatus.innerHTML="<em>The session is active</em> ✅":sessionShortcodePreviewStatus.innerHTML="<em>You can't preview your session when it's inactive</em> ❌";const shortcodePreviewDateTemp=Date.now(),shortcodePreviewStartDate=Date.parse(document.getElementById("visible_from").value),shortcodePreviewEndDate=Date.parse(document.getElementById("visible_to").value);sessionShortcodePreviewDateSettings.innerHTML=shortcodePreviewDateTemp<shortcodePreviewStartDate||shortcodePreviewDateTemp>shortcodePreviewEndDate?"<em>You can't preview your session with these start and end dates</em> ❌":"<em>The session start or end dates are correct</em> ✅","shortcode"==iconPlacementSelectedOption.value?toggleShortcodePreviewAlert():window.open(previewURL)}),shortcodePreviewAlertPrimaryButton.addEventListener("click",toggleShortcodePreviewAlert);const sessionTypeDefaultSettingBlocks=document.querySelectorAll(".gifthunt-card--session-type-default-setting"),sessionTypeCustomPopupSettingBlocks=document.querySelectorAll(".gifthunt-card--session-type-custom-popup-setting"),toggleSessionTypeSettings=sessionType=>{switch(sessionType){case"default":{const selectedGiftType=document.querySelector('input[name="gift_type"]:checked');sessionTypeDefaultSettingBlocks.forEach(block=>{"gifthunt-card--one-gift"==block.id?"oneMany"==selectedGiftType.value&&block.classList.remove("hidden"):"gifthunt-card--more-gifts"==block.id?"oneMany"!=selectedGiftType.value&&block.classList.remove("hidden"):block.classList.remove("hidden")}),sessionTypeCustomPopupSettingBlocks.forEach(block=>{block.classList.add("hidden")});break}case"custom_popup":sessionTypeCustomPopupSettingBlocks.forEach(block=>{block.classList.remove("hidden")}),sessionTypeDefaultSettingBlocks.forEach(block=>{block.classList.add("hidden")})}},sessionTypes=document.querySelectorAll('input[name="session_type"]');sessionTypes&&sessionTypes.forEach(sessionType=>{sessionType.addEventListener("change",e=>{toggleSessionTypeSettings(e.target.value)})});