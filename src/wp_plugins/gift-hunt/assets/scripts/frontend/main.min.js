!function(e){var n;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var t=window.Cookies,o=window.Cookies=e();o.noConflict=function(){return window.Cookies=t,o}}}((function(){function e(){for(var e=0,n={};e<arguments.length;e++){var t=arguments[e];for(var o in t)n[o]=t[o]}return n}function n(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function t(o){function r(){}function i(n,t,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},r.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var c=JSON.stringify(t);/^[\{\[]/.test(c)&&(t=c)}catch(e){}t=o.write?o.write(t,n):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=encodeURIComponent(String(n)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var f="";for(var u in i)i[u]&&(f+="; "+u,!0!==i[u]&&(f+="="+i[u].split(";")[0]));return document.cookie=n+"="+t+f}}function c(e,t){if("undefined"!=typeof document){for(var r={},i=document.cookie?document.cookie.split("; "):[],c=0;c<i.length;c++){var f=i[c].split("="),u=f.slice(1).join("=");t||'"'!==u.charAt(0)||(u=u.slice(1,-1));try{var a=n(f[0]);if(u=(o.read||o)(u,a)||n(u),t)try{u=JSON.parse(u)}catch(e){}if(r[a]=u,e===a)break}catch(e){}}return e?r[e]:r}}return r.set=i,r.get=function(e){return c(e,!1)},r.getJSON=function(e){return c(e,!0)},r.remove=function(n,t){i(n,"",e(t,{expires:-1}))},r.defaults={},r.withConverter=t,r}((function(){}))}));const currentLocation=window.location.href.split("#")[0],currentTime=Date.now();let winWidth=window.innerWidth,winHeight=window.innerHeight;const ffDiscounthuntCreateCORSRequest=(method,url)=>{const xhr=new XMLHttpRequest;return"withCredentials"in xhr?xhr.open(method,url,!0):"undefined"!=typeof XDomainRequest?(xhr=new XDomainRequest,xhr.open(method,url)):xhr=null,xhr},ffDiscounthuntCookieFound=ffDiscounthuntSessionId=>{let cookieData={cookieDate:Date.now(),sessionHuntId:ffDiscounthuntSessionId,codeFound:!0,codeFoundDate:Date.now(),pageviews:1,visitedPages:currentLocation};Cookies.set(`ffSessionHuntCookie_${ffDiscounthuntSessionId}`,cookieData,{expires:365})},ffHandleDiscounthuntFormSubmit=e=>{const ffDiscounthuntSubmitButton=document.querySelector("#ff-discounthunt-session-form__submit"),ffDiscounthuntSubmitButtonSpinner=ffDiscounthuntSubmitButton.querySelector("i");if(e.preventDefault(),ffDiscounthuntSessionPreview)return document.querySelector("#ff-discounthunt-session-modal__form-container").classList.add("ff-discounthunt-session--hidden"),document.querySelector("#ff-discounthunt-session-modal__description").classList.add("ff-discounthunt-session--hidden"),document.querySelector("#ff-discounthunt-session-modal__result").classList.remove("ff-discounthunt-session--hidden"),void(document.querySelector("#ff-discounthunt-session-modal__result-discountcode").innerHTML="PREVIEW CODE");const firstNameField=document.querySelector("#ff-discounthunt-session-form__first-name"),lastNameField=document.querySelector("#ff-discounthunt-session-form__last-name"),emailField=document.querySelector("#ff-discounthunt-session-form__email"),additionalInformationField=document.querySelector("#ff-discounthunt-session-form__additional"),legalCheckbox=document.querySelector("#ff-discounthunt-session-form__legal"),ffDiscounthuntHunterData={huntSession:ffDiscounthuntSessionData.id,firstName:firstNameField.value,lastName:lastNameField.value,email:emailField.value,additionalInformation:additionalInformationField.value,legalAccepted:legalCheckbox.checked,nonce:ffDiscounthuntNonce,action:"gifthuntfree_ajax_frontend_action",gifthuntfreeAction:"collect"};let ffDiscounthuntErrorCount=0;if(ffDiscounthuntHunterData.firstName.length<1&&1==ffDiscounthuntSessionData.form_collect_first_name?(firstNameField.classList.add("ffDiscounthuntFieldError"),ffDiscounthuntErrorCount++):firstNameField.classList.remove("ffDiscounthuntFieldError"),ffDiscounthuntHunterData.lastName.length<1&&1==ffDiscounthuntSessionData.form_collect_last_name?(lastNameField.classList.add("ffDiscounthuntFieldError"),ffDiscounthuntErrorCount++):lastNameField.classList.remove("ffDiscounthuntFieldError"),ffDiscounthuntHunterData.email.length<1||!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(ffDiscounthuntHunterData.email)?(emailField.classList.add("ffDiscounthuntFieldError"),ffDiscounthuntErrorCount++):emailField.classList.remove("ffDiscounthuntFieldError"),legalCheckbox.checked?document.querySelector("#ff-discounthunt-session-form__group--legal a").classList.remove("ffDiscounthuntFieldErrorText"):(document.querySelector("#ff-discounthunt-session-form__group--legal a").classList.add("ffDiscounthuntFieldErrorText"),ffDiscounthuntErrorCount++),ffDiscounthuntErrorCount)return;ffDiscounthuntSubmitButton.disabled=!0,ffDiscounthuntSubmitButtonSpinner.classList.remove("ff-discounthunt-session--hidden");const ffDiscounthuntXHR=ffDiscounthuntCreateCORSRequest("POST",ffDiscounthuntApiEndpoint);if(!ffDiscounthuntXHR)return ffDiscounthuntSubmitButton.disabled=!1,ffDiscounthuntSubmitButtonSpinner.classList.add("ff-discounthunt-session--hidden"),void alert("Something went wrong. Please refresh the page and try again.");ffDiscounthuntXHR.setRequestHeader("X-Custom-Header",ffDiscounthuntNonce),ffDiscounthuntXHR.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),ffDiscounthuntXHR.onload=function(){const response=JSON.parse(ffDiscounthuntXHR.responseText);if(ffDiscounthuntSubmitButton.disabled=!1,ffDiscounthuntSubmitButtonSpinner.classList.add("ff-discounthunt-session--hidden"),"error"!==response.status&&response)return"closed"!==response.status?(document.querySelector("#ff-discounthunt-session-modal__form-container").classList.add("ff-discounthunt-session--hidden"),document.querySelector("#ff-discounthunt-session-modal__description").classList.add("ff-discounthunt-session--hidden"),document.querySelector("#ff-discounthunt-session-modal__result").classList.remove("ff-discounthunt-session--hidden"),document.querySelector("#ff-discounthunt-session-modal__result-discountcode").innerHTML=response.data,void ffDiscounthuntCookieFound(ffDiscounthuntSessionData.id)):(ffToggleDiscountHuntSessionPopup(),void Cookies.remove(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`));alert(response.data)},ffDiscounthuntXHR.onerror=function(){ffDiscounthuntSubmitButton.disabled=!1,ffDiscounthuntSubmitButtonSpinner.classList.add("ff-discounthunt-session--hidden"),alert("Something went wrong. Please refresh the page and try again.")},ffDiscounthuntXHR.send(Object.keys(ffDiscounthuntHunterData).map((function(k){return encodeURIComponent(k)+"="+encodeURIComponent(ffDiscounthuntHunterData[k])})).join("&"))},ffToggleDiscountHuntSessionPopup=()=>{if(document.body.classList.contains("ffDiscounthuntPopupVisible")){const ffDiscounhuntPopupRoot=document.querySelector("#ff-discounthunt-popup-root");ffDiscounhuntPopupRoot.parentNode.removeChild(ffDiscounhuntPopupRoot),document.body.classList.remove("ffDiscounthuntPopupVisible")}else{let ffDiscountHuntSessionPopupContaner;if("custom_popup"==ffDiscounthuntSessionData.session_type?(ffDiscountHuntSessionPopupContaner=document.getElementById("ff-discounthunt-popup-root"),ffDiscounthuntCookieFound(ffDiscounthuntSessionData.id)):(ffDiscountHuntSessionPopupContaner=document.createElement("div"),ffDiscountHuntSessionPopupContaner.style.cssText="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, .6); z-index: 999999; overflow-y: auto; overflow-x: hidden;",ffDiscountHuntSessionPopupContaner.setAttribute("id","ff-discounthunt-popup-root"),ffDiscountHuntSessionPopupContaner.innerHTML=ffDiscounthuntPopupWindow,ffDiscountHuntSessionPopupContaner.querySelector("#ff-discounthunt-session-modal__form").addEventListener("submit",ffHandleDiscounthuntFormSubmit)),!document.body.classList.contains("ffDiscounthuntPopupCSSAdded")){const ffDiscounthuntHead=document.head;let ffDiscounthuntExtraStyle=document.createElement("style");ffDiscounthuntHead.appendChild(ffDiscounthuntExtraStyle),ffDiscounthuntExtraStyle.type="text/css",ffDiscounthuntExtraStyle.styleSheet?ffDiscounthuntExtraStyle.styleSheet.cssText=ffDiscounthuntCSS:ffDiscounthuntExtraStyle.appendChild(document.createTextNode(ffDiscounthuntCSS)),document.body.classList.add("ffDiscounthuntPopupCSSAdded");let ffDiscounthuntIcon=null;const shortcodePlacement=!(!ffDiscounthuntSessionData.icon_placement||"shortcode"!=ffDiscounthuntSessionData.icon_placement);ffDiscounthuntIcon=shortcodePlacement?document.querySelector("a#ff-discounthunt-icon-container"):document.querySelector("#ff-discounthunt-present-icon"),ffDiscounthuntIcon.parentNode.removeChild(ffDiscounthuntIcon)}"custom_popup"==ffDiscounthuntSessionData.session_type?ffDiscountHuntSessionPopupContaner.style.display="block":document.body.appendChild(ffDiscountHuntSessionPopupContaner),document.body.classList.add("ffDiscounthuntPopupVisible")}};let cookieData={cookieDate:currentTime,sessionHuntId:ffDiscounthuntSessionData.id,codeFound:!1,pageviews:1,visitedPages:currentLocation};const ffDiscounthuntSessionIconCss=()=>{if(!document.body.classList.contains("ffDiscounthuntIconCSSAdded")){const ffDiscounthuntHead=document.head;let ffDiscounthuntExtraStyle=document.createElement("style");ffDiscounthuntHead.appendChild(ffDiscounthuntExtraStyle),ffDiscounthuntExtraStyle.type="text/css",ffDiscounthuntExtraStyle.styleSheet?ffDiscounthuntExtraStyle.styleSheet.cssText=ffDiscounthuntIconCSS:ffDiscounthuntExtraStyle.appendChild(document.createTextNode(ffDiscounthuntIconCSS)),document.body.classList.add("ffDiscounthuntIconCSSAdded")}},ffDiscounthuntInit=()=>{const shortcodePlacement=!(!ffDiscounthuntSessionData.icon_placement||"shortcode"!=ffDiscounthuntSessionData.icon_placement);let shortcodeGifthuntIcon=document.querySelector("a#ff-discounthunt-icon-container");if(Cookies.get(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`)||ffDiscounthuntSessionPreview||shortcodePlacement){let cookieValue;if(shortcodePlacement&&!Cookies.get(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`)?(cookieValue=cookieData,Cookies.set(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`,cookieData,{expires:365})):cookieValue=Cookies.getJSON(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`),!ffDiscounthuntSessionPreview&&1==cookieValue.codeFound&&1!=ffDiscounthuntSessionData.allow_multiple_collect)return void(shortcodePlacement&&shortcodeGifthuntIcon&&shortcodeGifthuntIcon.remove());if(ffDiscounthuntSessionIconCss(),shortcodePlacement)return void(shortcodeGifthuntIcon&&shortcodeGifthuntIcon.addEventListener("click",ffToggleDiscountHuntSessionPopup));const ffDiscountHuntPresentIcon=document.createElement("div");let iconTopPosition=0,iconLeftPosition=0;if(ffDiscounthuntSessionData.icon_placement&&"center"==ffDiscounthuntSessionData.icon_placement?(iconTopPosition=Math.floor((winHeight-80)/2),iconLeftPosition=Math.floor((winWidth-80)/2)):ffDiscounthuntSessionData.icon_placement&&"bottom_left"==ffDiscounthuntSessionData.icon_placement?(iconTopPosition=winHeight-100,iconLeftPosition=20):ffDiscounthuntSessionData.icon_placement&&"bottom_right"==ffDiscounthuntSessionData.icon_placement?(iconTopPosition=winHeight-100,iconLeftPosition=winWidth-100):(iconTopPosition=Math.floor(Math.random()*(winHeight-120)),iconLeftPosition=Math.floor(Math.random()*(winWidth-120))),ffDiscountHuntPresentIcon.setAttribute("id","ff-discounthunt-present-icon"),ffDiscountHuntPresentIcon.setAttribute("class",ffDiscounthuntSessionData.icon_animation||"pop"),ffDiscountHuntPresentIcon.style.cssText=`top: ${iconTopPosition}px; left: ${iconLeftPosition}px;`,99==ffDiscounthuntSessionData.icon?ffDiscountHuntPresentIcon.innerHTML=`<a class="ff-discounthunt-icon-link"><div id="ff-discounthunt-icon-container"><img src="${decodeURIComponent(ffDiscounthuntSessionData.custom_icon)}" alt="Gift Hunt Icon" /></div></a>`:ffDiscountHuntPresentIcon.innerHTML=`<a class="ff-discounthunt-icon-link"><div id="ff-discounthunt-icon-container"><img src="${ffDiscounthuntFrontendAssets}images/${ffDiscounthuntSessionData.icon}.svg" alt="Gift Hunt Icon" /></div></a>`,ffDiscountHuntPresentIcon.addEventListener("click",ffToggleDiscountHuntSessionPopup),ffDiscounthuntSessionPreview)document.body.appendChild(ffDiscountHuntPresentIcon);else{"time"==ffDiscounthuntSessionData.display_type&&Math.floor((Date.now()-cookieValue.cookieDate)/1e3)>=ffDiscounthuntSessionData.time_to_display?document.body.appendChild(ffDiscountHuntPresentIcon):"pageview"==ffDiscounthuntSessionData.display_type&&cookieValue.pageviews>=ffDiscounthuntSessionData.pageview_to_display&&document.body.appendChild(ffDiscountHuntPresentIcon);const visitedPages=cookieValue.visitedPages.includes(currentLocation)?cookieValue.visitedPages:`${cookieValue.visitedPages}|${currentLocation}`,visitedPagesArray=visitedPages.split("|"),pageviews=visitedPagesArray.length;cookieData={cookieDate:cookieValue.cookieDate,sessionHuntId:cookieValue.sessionHuntId,codeFound:cookieValue.codeFound,pageviews:pageviews,visitedPages:visitedPages},Cookies.set(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`,cookieData,{expires:365})}}else Cookies.set(`ffSessionHuntCookie_${ffDiscounthuntSessionData.id}`,cookieData,{expires:365})};window.onresize=()=>{winWidth=window.innerWidth,winHeight=window.innerHeight},document.body.addEventListener("click",e=>{"ff-discounthunt-session-modal__close"!=e.target.id&&"ff-discounthunt-custom-modal__close"!=e.target.id||ffToggleDiscountHuntSessionPopup()}),ffDiscounthuntInit();